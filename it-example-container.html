<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at May 29, 2011 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Maven Unit and Integration Test Guide - Container Integration Test Example</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
      <meta name="author" content="Karl Heinz Marbaise" />
    <meta name="Date-Revision-yyyymmdd" content="20110529" />
    <meta http-equiv="Content-Language" content="en" />
        
  </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                MaUI Test Guide
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2011-05-29</span>
                  &nbsp;| <span id="projectVersion">Version: 0.1-SNAPSHOT</span>
                      </div>
            <div class="xright">        
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="examples.html" title="Examples">Examples</a>
            </li>
          </ul>
                       <h5>Unit Tests</h5>
                  <ul>
                  <li class="none">
                          <a href="overview-unit-test.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="ut-example.html" title="Example">Example</a>
            </li>
                  <li class="none">
                          <a href="ut-example-interface.html" title="Interface">Interface</a>
            </li>
                  <li class="none">
                          <a href="ut-example-mu.html" title="Multiple Usage">Multiple Usage</a>
            </li>
          </ul>
                       <h5>Integration Tests</h5>
                  <ul>
                  <li class="none">
                          <a href="overview-integration-test.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="it-example.html" title="Basic Example">Basic Example</a>
            </li>
                  <li class="none">
                          <a href="it-example-1.html" title="Different Source Location">Different Source Location</a>
            </li>
                  <li class="none">
            <strong>Container Example</strong>
          </li>
                  <li class="none">
                          <a href="it-example-interface.html" title="Interface">Interface</a>
            </li>
                  <li class="none">
                          <a href="it-example-multiple-times.html" title="Running multiple times">Running multiple times</a>
            </li>
          </ul>
                       <h5>Maven Plugin Integration Tests</h5>
                  <ul>
                  <li class="none">
                          <a href="overview-mp-it.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="mp-it-source-example.html" title="Basic Source Example">Basic Source Example</a>
            </li>
                  <li class="none">
                          <a href="mp-it-example.html" title="Basic Example">Basic Example</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!--  --><!-- The Maven Unit- and Integration Test Guide (MaUI for short) --><!--  --><!-- Copyright (c) 2011 by SoftwareEntwicklung Beratung Schulung (SoEBeS) --><!-- Copyright (c) 2011 by Karl Heinz Marbaise --><!--  --><!-- Licensed to the Apache Software Foundation (ASF) under one or more --><!-- contributor license agreements.  See the NOTICE file distributed with --><!-- this work for additional information regarding copyright ownership. --><!-- The ASF licenses this file to You under the Apache License, Version 2.0 --><!-- (the "License"); you may not use this file except in compliance with --><!-- the License.  You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><!--  --><div class="section"><h2>Integration Test Example Container<a name="Integration_Test_Example_Container"></a></h2><p>This example will describe how to do integration-testing with a web application which will be deployed to a servlet container like <a class="externalLink" href="http://tomcat.apache.org">Tomcat</a>.</p><p>In this example we use the <a class="externalLink" href="http://cargo.codehaus.org/Home">CARGO Plugin</a> to do the integration test of a web application. By the help of Cargo it's simply possible to do the startup of a container, deploy the web application (war) start the container and run the integration tests and finally stop the container.</p><p><a class="externalLink" href="http://cargo.codehaus.org/Home#Home-ContainerSupport">Cargo supports a large number of containers</a> which can be used either via the <a class="externalLink" href="http://cargo.codehaus.org/Javadocs">Java API</a> or in our case via the <a class="externalLink" href="http://cargo.codehaus.org/Maven2+plugin">Maven 2/3 Plugin</a>.</p><p>This is of course not the only possibility to start a container, but in my opinion the simplest one but in spite of that very effective.</p><p>In this example we have the following structure of the different modules which are more or less typical for a Maven project which contains a WAR part. This is also true if you have EAR part.</p><p>This first example does not contain any real integration test it will show only the structure of how an integration test looks like in relationship with a WAR package.</p><div class="source"><pre>.
|-- mod-api
|   `-- pom.xml
|-- mod-it
|   `-- pom.xml
|-- mod-war
|   |-- pom.xml
|   `-- src
|       |-- main
|       |   |-- java
|       |   |   `-- com
|       |   |       `-- soebes
|       |   |           `-- wicket
|       |   |               |-- HomePage.java
|       |   |               `-- WicketApplication.java
|       |   |-- resources
|       |   |   |-- com
|       |   |   |   `-- soebes
|       |   |   |       `-- wicket
|       |   |   |           `-- HomePage.html
|       |   |   `-- log4j.properties
|       |   `-- webapp
|       |       `-- WEB-INF
|       |           `-- web.xml
|       `-- test
|           `-- java
|               `-- com
|                   `-- soebes
|                       `-- wicket
|                           |-- Start.java
|                           `-- TestHomePage.java
`-- pom.xml</pre></div><p>Now let us focus on the <tt>mod-it</tt> module which contains the configuration for the <tt>cargo-maven2-plugin</tt> which is responsible to start, deploy and stop the container.</p><p>One of the most important things is that your <tt>mod-it</tt> module contains a dependency to your war project which looks like this in the <tt>pom.xml</tt> file.</p><div class="source"><pre>  [...]
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
      &lt;artifactId&gt;mod-war&lt;/artifactId&gt;
      &lt;version&gt;${project.version}&lt;/version&gt;
      &lt;type&gt;war&lt;/type&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  [...]</pre></div><p>Furthermore we take a look onto the configuration for the cargo-maven2-plugin which contains first the kind of container we would like to run which is defined by the <tt>containerId</tt> and the <tt>zipUrlInstaller</tt> area which defines where to get the container from. In this example the container (Tomcat) will be downloaded automatically from the given download area (url) downloaded into the given folder <tt>downloadDir</tt> and extracted into the given folder <tt>extractDir</tt>. Here we use the default which is defined by the <tt>cargo-maven2-plugin</tt>.</p><p>This approach has the advantage that you don't need to have an installed Tomcat somewhere. This build will work on every platform. The only limitation is that the download via the given url needs internet access.</p><p>The other important thing is under which port the given instance of Tomcat will. This is defined by the <tt>cargo.servlet.port</tt>. This might be changed later using an environment variable to be able to control it from outside. This can be usefull if you are running on an continous integration solution like Jenkins etc.</p><div class="source"><pre>  [...]
  &lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.cargo&lt;/groupId&gt;
    &lt;artifactId&gt;cargo-maven2-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
      &lt;wait&gt;false&lt;/wait&gt;
      &lt;container&gt;
        &lt;containerId&gt;tomcat${tomcat.major}x&lt;/containerId&gt;
        &lt;zipUrlInstaller&gt;
          &lt;url&gt;http://archive.apache.org/dist/tomcat/tomcat-${tomcat.major}/v${tomcat.version}/bin/apache-tomcat-${tomcat.version}.tar.gz&lt;/url&gt;
          &lt;downloadDir&gt;${project.build.directory}/cargo/download/&lt;/downloadDir&gt;
          &lt;extractDir&gt;${installDir}&lt;/extractDir&gt;
        &lt;/zipUrlInstaller&gt;
        &lt;output&gt;${project.build.directory}/tomcat${tomcat.major}x.log&lt;/output&gt;
        &lt;log&gt;${project.build.directory}/cargo.log&lt;/log&gt;
      &lt;/container&gt;
      &lt;configuration&gt;
        &lt;home&gt;${project.build.directory}/tomcat-${tomcat.version}/container&lt;/home&gt;
        &lt;properties&gt;
          &lt;cargo.logging&gt;high&lt;/cargo.logging&gt;
          &lt;cargo.servlet.port&gt;9080&lt;/cargo.servlet.port&gt;
        &lt;/properties&gt;
      &lt;/configuration&gt;
    &lt;/configuration&gt;
    [...]</pre></div><p>The next part is to start and deploy the war file into the container which can be achieved by using the following execution block. The pingURL is needed to see if your application startup is finished or not. The pingTimeout defines how long this will be tried in the worst case. The value is given in ms. The context is usually the name of the war file, but this is not very convenient so you can change this by using the <tt>context</tt> property to control this. Further details can be found in the documentation of the cargo-maven2-plugin.</p><div class="source"><pre>    &lt;executions&gt;
      &lt;execution&gt;
        &lt;id&gt;start-container&lt;/id&gt;
        &lt;phase&gt;pre-integration-test&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;start&lt;/goal&gt;
          &lt;goal&gt;deploy&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;configuration&gt;
          &lt;deployer&gt;
            &lt;deployables&gt;
              &lt;deployable&gt;
                &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;
                &lt;artifactId&gt;mod-war&lt;/artifactId&gt;
                &lt;type&gt;war&lt;/type&gt;
                &lt;pingURL&gt;http://localhost:9080/mod-war&lt;/pingURL&gt;
                &lt;pingTimeout&gt;30000&lt;/pingTimeout&gt;
                &lt;properties&gt;
                  &lt;context&gt;mod-war&lt;/context&gt;
                &lt;/properties&gt;
              &lt;/deployable&gt;
            &lt;/deployables&gt;
          &lt;/deployer&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;</pre></div><p>And last but not least the final part stopping the container is simply configured by the following execution block.</p><div class="source"><pre>      &lt;execution&gt;
        &lt;id&gt;stop-container&lt;/id&gt;
        &lt;phase&gt;post-integration-test&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;stop&lt;/goal&gt;
        &lt;/goals&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
  &lt;/plugin&gt;
  [...]</pre></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">Copyright &#169;                    2011
                        <a href="http://www.soebes.com">SoftwareEntwicklung Beratung Schulung</a>.
            All Rights Reserved.      
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
